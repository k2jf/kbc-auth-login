<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.k2data.kbc.usrmgr.dao.RoleResourceMapper">
    <resultMap id="BaseResultMap" type="com.k2data.kbc.usrmgr.model.RoleResource">
        <id column="role_id" property="roleId"/>
        <result column="resource_id" property="resourceId"/>
        <result column="operations" property="operations"/>
        <result column="effect_time" property="effectTime"/>
        <result column="expire_time" property="expireTime"/>
        <result column="disabled" property="disabled"/>
    </resultMap>

    <insert id="insert" keyProperty="id">
      INSERT INTO role_resource (
        role_id,
        resource_id,
        operations,
        effect_time,
        expire_time,
        disabled
      )
      VALUES (
        #{roleId},
        #{resourceId},
        #{operations},
        #{effectTime},
        #{expireTime},
        #{disabled}
      )
    </insert>

    <delete id="delete">
        DELETE
        FROM role_resource
        WHERE role_id = #{arg0} AND resource_id = #{arg1}
    </delete>

    <select id="list"
        parameterType="com.k2data.kbc.usrmgr.dao.condition.RoleResourceCondition"
        resultMap="BaseResultMap">
        SELECT *
        FROM role_resource
        WHERE 1 = 1
        <if test="roleId != null and roleId != ''">
            <![CDATA[ AND role_id = #{roleId}]]>
        </if>
        <if test="resourceIds != null and resourceIds.size > 0">
            <![CDATA[ AND resource_id IN ]]>
            <foreach close=")" collection="resourceIds" index="index" item="item" open="("
                separator=",">
                <![CDATA[ #{item} ]]>
            </foreach>
        </if>
    </select>

    <select id="getByRoleIds" resultMap="BaseResultMap">
        SELECT *
        FROM role_resource
        WHERE 1 = 0
        <if test="list != null and list.size > 0">
            <![CDATA[ OR role_id IN ]]>
            <foreach close=")" collection="list" index="index" item="item" open="("
                separator=",">
                <![CDATA[ #{item} ]]>
            </foreach>
        </if>
    </select>
</mapper>